### 자바스크립트에서 비동기 처리와 코드 실행 순서 이해하기

자바스크립트는 비동기 프로그래밍을 중심으로 설계된 언어입니다. 특히 자바스크립트의 엔진은 **동기적인 코드**와 **비동기적인 코드**를 처리하는 방법이 매우 중요합니다. 이 블로그에서는 비동기 코드 실행의 기본 개념과 자바스크립트의 코드 실행 순서를 분석해 보겠습니다.

---

#### 코드 분석

다음 코드를 한번 살펴보겠습니다.

```javascript
const promise = new Promise((resolve, reject) => {
  console.log(1);
  setTimeout(() => {
    console.log("timerStart");
    resolve("success");
    console.log("timerEnd");
  }, 0);
  console.log(2);
});

promise.then((res) => {
  console.log(res);
});

console.log(4);
```

이 코드의 실행 결과가 궁금하다면, 먼저 자바스크립트가 **동기적 작업**과 **비동기적 작업**을 처리하는 방식을 이해해야 합니다.

### 자바스크립트의 실행 순서

자바스크립트는 **단일 스레드** 언어로, 한 번에 하나의 작업만 처리할 수 있습니다. 하지만 비동기 작업을 지원하기 위해 **이벤트 루프(Event Loop)**라는 메커니즘을 활용합니다. 자바스크립트의 코드 실행 순서는 크게 두 가지로 나눌 수 있습니다.

1. **동기적 코드**: 즉시 실행되는 코드입니다.
2. **비동기적 코드**: 나중에 실행되는 코드로, 주로 콜백 함수나 프라미스(Promise)를 통해 처리됩니다.

이 코드를 분석해 보면:

- `new Promise` 내부에서 `console.log(1)`이 먼저 실행됩니다.
- `setTimeout`은 **비동기 작업**이므로 나중에 실행됩니다. 하지만 이때 콜백 함수가 바로 실행되지 않고, 0밀리초의 대기 시간이 설정됩니다.
- 그다음 `console.log(2)`가 즉시 실행됩니다.
- `promise.then`은 비동기적으로 처리되기 때문에 나중에 실행됩니다.
- 마지막으로 `console.log(4)`가 즉시 실행됩니다.

그러면 **비동기 코드**인 `setTimeout`의 콜백과 `promise.then`은 언제 실행될까요?

1. `setTimeout`의 콜백은 **매크로 태스크**에 들어갑니다.
2. `promise.then`은 **마이크로 태스크**에 들어갑니다.

자바스크립트는 먼저 **동기적 코드**를 모두 실행한 후, **마이크로 태스크**를 처리하고, 마지막으로 **매크로 태스크**를 처리합니다.

---

### 코드 실행 순서 요약

이 코드를 실행했을 때 결과는 다음과 같습니다:

1. `console.log(1)` – 먼저 1이 출력됩니다.
2. `console.log(2)` – 그다음 2가 출력됩니다.
3. `console.log(4)` – 동기적 코드를 다 처리했으므로 4가 출력됩니다.
4. `promise.then`의 콜백이 실행되어 **"success"**가 출력됩니다.
5. 마지막으로 **매크로 태스크**인 `setTimeout`의 콜백이 실행됩니다. 이때 **"timerStart"**와 **"timerEnd"**가 차례로 출력됩니다.

### 최종 출력 결과:

```bash
1
2
4
success
timerStart
timerEnd
```

---

### 마이크로 태스크와 매크로 태스크

여기서 중요한 개념은 **마이크로 태스크**와 **매크로 태스크**입니다.

- **마이크로 태스크**: `promise.then`과 같은 프라미스의 후속 작업은 마이크로 태스크 큐에 들어갑니다. 이 작업은 모든 동기 작업이 완료된 후에 즉시 실행됩니다.
- **매크로 태스크**: `setTimeout`과 같은 타이머 콜백 함수는 매크로 태스크 큐에 들어갑니다. 이 작업은 마이크로 태스크가 모두 끝난 후에 실행됩니다.

---

### 비슷한 예시

자, 비슷한 예시 코드를 하나 더 보겠습니다.

```javascript
console.log("start");

const promise1 = new Promise((resolve, reject) => {
  console.log(1);
  resolve(2);
});

promise1.then((res) => {
  console.log(res);
});

console.log("end");
```

이 코드의 출력 결과는 다음과 같습니다:

```bash
start
1
end
2
```

**분석**: 여기서도 동기 작업인 `console.log('start')`, `console.log(1)`, `console.log('end')`가 먼저 실행되고, 그 후에 프라미스의 `then` 콜백이 실행되어 **2**가 출력됩니다.

---

### 결론

자바스크립트의 비동기 처리는 이벤트 루프와 관련된 중요한 개념입니다. 자바스크립트는 먼저 **동기 작업**을 처리한 후, **마이크로 태스크**를 처리하고, 마지막으로 **매크로 태스크**를 처리합니다. 이 원리를 이해하면 비동기 코드의 실행 순서를 예측할 수 있습니다.

---

이 블로그 글이 여러분의 자바스크립트 비동기 처리 이해에 도움이 되길 바랍니다.
